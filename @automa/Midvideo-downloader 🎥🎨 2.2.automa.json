{"extVersion":"1.29.12","name":"Midvideo-downloader üé•üé® 2.0","icon":"riGlobalLine","table":[],"version":"1.29.12","drawflow":{"nodes":[{"id":"JnAVtOJ0zOultqutysm9N","type":"BlockBasic","initialized":false,"position":{"x":183.34861577822983,"y":398.9383399018193},"data":{"disableBlock":false,"description":"","type":"manual","interval":60,"delay":5,"date":"","time":"00:00","url":"","shortcut":"","activeInInput":false,"isUrlRegex":false,"days":[],"contextMenuName":"","contextTypes":[],"parameters":[],"preferParamsInTab":false,"observeElement":{"selector":"","baseSelector":"","matchPattern":"","targetOptions":{"subtree":false,"childList":true,"attributes":false,"attributeFilter":[],"characterData":false},"baseElOptions":{"subtree":false,"childList":true,"attributes":false,"attributeFilter":[],"characterData":false}},"triggers":[{"data":{"activeInInput":false,"contextMenuName":"","contextTypes":[],"date":"","days":[],"delay":5,"description":"","disableBlock":false,"interval":60,"isUrlRegex":false,"observeElement":{"baseElOptions":{"attributeFilter":[],"attributes":false,"characterData":false,"childList":true,"subtree":false},"baseSelector":"","matchPattern":"","selector":"","targetOptions":{"attributeFilter":[],"attributes":false,"characterData":false,"childList":true,"subtree":false}},"parameters":[],"preferParamsInTab":false,"shortcut":"","time":"00:00","type":"manual","url":""},"id":"N900u","type":"manual"},{"data":{"days":[{"id":0,"times":["01:00:00"]},{"id":2,"times":["01:00:00"]},{"id":4,"times":["01:00:00"]},{"id":6,"times":["01:00:00"]},{"id":1,"times":["01:00:00"]},{"id":3,"times":["01:00:00"]},{"id":5,"times":["01:00:00"]}],"time":"00:00"},"id":"EBerh","type":"specific-day"},{"data":{"contextMenuName":"Midvideo-downloader üé•üé® 2.0","contextTypes":[]},"id":"MJS6Y","type":"context-menu"}]},"label":"trigger"},{"id":"2d7n5vo","type":"BlockBasic","initialized":false,"position":{"x":559.7104922851563,"y":398.403957945424},"data":{"activeTab":true,"createIfNoMatch":true,"description":"","disableBlock":false,"findTabBy":"match-patterns","matchPattern":"https://www.midjourney.com/explore?tab=video_top","tabIndex":0,"tabTitle":"","url":"https://www.midjourney.com/explore?tab=video_top"},"label":"switch-tab"},{"id":"q3z056a","type":"BlockBasic","initialized":false,"position":{"x":966.7618716672091,"y":400.3422978472434},"data":{"code":"(() => {\n  class VideoURLCollector {\n    constructor(options = {}) {\n      const container = options.scrollContainer || document.getElementById('pageScroll');\n      if (!container) throw new Error('Scroll container #pageScroll not found.');\n      this.scrollContainer = container;\n\n      this.maxVideos = options.maxVideos ?? 100;        // target\n      this.batchWaitTime = options.batchWaitTime ?? 5000; // legacy, still used between attempts\n      this.scrollStepRatio = options.scrollStepRatio ?? 0.9; // how far towards bottom per step\n      this.lazyPollMs = options.lazyPollMs ?? 2500;     // how long to poll after a scroll for new URLs\n      this.lazyPollInterval = options.lazyPollInterval ?? 300; // poll cadence\n      this.noProgressLimit = options.noProgressLimit ?? 6; // how many consecutive no-progress steps before stopping\n\n      this.videoUrls = new Set();\n      this.isRunning = false;\n      this.attempt = 0;\n    }\n\n    delay(ms) { return new Promise(res => setTimeout(res, ms)); }\n\n    static cssEscape(str) {\n      if (window.CSS && typeof window.CSS.escape === 'function') return window.CSS.escape(str);\n      return String(str).replace(/[^a-zA-Z0-9_\\-]/g, s => '\\\\' + s.charCodeAt(0).toString(16) + ' ');\n    }\n\n    normalizeUrl(url) {\n      if (!url) return null;\n      try { const u = new URL(url, location.href); u.hash = ''; return u.href; } catch { return null; }\n    }\n\n    getVideoUrls() {\n      const urls = new Set();\n      document.querySelectorAll('video[src]').forEach(v => { const u = this.normalizeUrl(v.getAttribute('src')); if (u && u.endsWith('.mp4')) urls.add(u); });\n      document.querySelectorAll('source[src]').forEach(s => { const u = this.normalizeUrl(s.getAttribute('src')); if (u && u.endsWith('.mp4')) urls.add(u); });\n      document.querySelectorAll(\"a[href*='.mp4']\").forEach(a => { const u = this.normalizeUrl(a.getAttribute('href')); if (u && u.endsWith('.mp4')) urls.add(u); });\n      document.querySelectorAll('[data-src],[data-url]').forEach(el => { const cand = el.getAttribute('data-src') || el.getAttribute('data-url'); const u = this.normalizeUrl(cand); if (u && u.endsWith('.mp4')) urls.add(u); });\n      return Array.from(urls);\n    }\n\n    ensureHighlightStyles() {\n      if (document.getElementById('__video_pick_styles')) return;\n      const style = document.createElement('style');\n      style.id = '__video_pick_styles';\n      style.textContent = `.video-picked{border:3px dotted #00ff3b!important;border-radius:12px;box-shadow:0 0 0 2px rgba(16,185,129,.15);transition:all .2s ease;background:rgba(16,185,129,.05)!important}.batch-highlight{border:2px solid #06f!important;box-shadow:0 0 8px rgba(0,102,255,.3)}`;\n      document.head.appendChild(style);\n    }\n\n    highlightBatchElements(newUrls) {\n      this.ensureHighlightStyles();\n      newUrls.forEach(url => {\n        try {\n          const esc = VideoURLCollector.cssEscape(url);\n          const nodes = [\n            ...document.querySelectorAll(`video[src=\"${esc}\"]`),\n            ...document.querySelectorAll(`source[src=\"${esc}\"]`)\n          ];\n          nodes.forEach(node => {\n            const card = node.closest('div[draggable=\"true\"]') || node.closest('a') || node;\n            if (card) {\n              card.classList.add('video-picked','batch-highlight');\n              setTimeout(() => card.classList.remove('batch-highlight'), 2000);\n            }\n          });\n        } catch {}\n      });\n    }\n\n    saveUrls(urls) {\n      const newlyAdded = [];\n      urls.forEach(u => { if (u && !this.videoUrls.has(u)) { this.videoUrls.add(u); newlyAdded.push(u); }});\n      if (newlyAdded.length) {\n        console.log(`+ added ${newlyAdded.length} (total ${this.videoUrls.size}/${this.maxVideos})`);\n      }\n      return newlyAdded;\n    }\n\n    // Core: scroll near bottom, then poll briefly for new items\n    async scrollAndHarvestOnce() {\n      const c = this.scrollContainer;\n      const beforeTop = c.scrollTop;\n      const beforeHeight = c.scrollHeight;\n\n      // Scroll towards bottom\n      const step = Math.floor(c.clientHeight * this.scrollStepRatio);\n      c.scrollTop = Math.min(beforeTop + step, c.scrollHeight);\n      console.log(`[Attempt ${this.attempt}] Scrolled: top ${beforeTop} -> ${c.scrollTop} (h=${beforeHeight})`);\n\n      // Poll for lazy-load\n      const start = Date.now();\n      let grew = false;\n      while (Date.now() - start < this.lazyPollMs) {\n        automaResetTimeout();\n        const prev = this.videoUrls.size;\n        const newUrls = this.saveUrls(this.getVideoUrls());\n        if (newUrls.length) { this.highlightBatchElements(newUrls); grew = true; break; }\n        await this.delay(this.lazyPollInterval);\n      }\n\n      // Detect end-of-list if height/top no longer change meaningfully\n      const ended = !grew && c.scrollTop >= (c.scrollHeight - c.clientHeight - 2);\n      return { grew, ended };\n    }\n\n    async main() {\n      if (this.isRunning) return this.getCollectedUrls();\n      this.isRunning = true; this.attempt = 0;\n      console.log(`üöÄ Collecting up to ${this.maxVideos} videos...`);\n\n      try {\n        automaResetTimeout();\n        // Seed from current viewport\n        const seed = this.saveUrls(this.getVideoUrls());\n        if (seed.length) this.highlightBatchElements(seed);\n\n        let noProgress = 0;\n        while (this.videoUrls.size < this.maxVideos && noProgress < this.noProgressLimit) {\n          this.attempt++;\n          automaResetTimeout();\n\n          const { grew, ended } = await this.scrollAndHarvestOnce();\n          if (grew) {\n            noProgress = 0;\n            console.log(`‚úì Progress: ${this.videoUrls.size}/${this.maxVideos}`);\n          } else {\n            noProgress++;\n            console.log(`‚Ä¶ No progress (${noProgress}/${this.noProgressLimit})`);\n          }\n\n          if (ended) {\n            console.log('Reached end of list / container height.');\n            break;\n          }\n        }\n\n        const result = Array.from(this.videoUrls).slice(0, this.maxVideos);\n        window.__collectedMp4Urls__ = result;\n        console.log(`‚úÖ Done. Collected ${result.length} unique .mp4 URLs in ${this.attempt} attempts.`);\n        if (result.length < this.maxVideos) console.log('üí° Fewer items available than target; stopping gracefully.');\n        return result;\n      } catch (e) {\n        console.error('‚ùå Collection error:', e);\n        return Array.from(this.videoUrls);\n      } finally { this.isRunning = false; }\n    }\n\n    getCollectedUrls() { return Array.from(this.videoUrls); }\n  }\n\n  const VideoCollectorUtils = {\n    async collectVideos(maxVideos = 100, options = {}) {\n      const collector = new VideoURLCollector({ maxVideos, ...options });\n      return await collector.main();\n    },\n    createCollector(options = {}) { return new VideoURLCollector(options); }\n  };\n\n  window.VideoURLCollector = VideoURLCollector;\n  window.VideoCollectorUtils = VideoCollectorUtils;\n})();\n\nfunction transformUrlsToObjects(urls) {\n  return urls.map(videoUrl => {\n    const match = videoUrl.match(/\\/video\\/([^/]+)\\//);\n    const videoName = match ? match[1] : null;\n    const pageUrl = videoName ? `https://www.midjourney.com/jobs/${videoName}?index=0` : null;\n    return { videoUrl, pageUrl, videoName, downloaded: false };\n  });\n}\n\n(() => {\n  let __done = false; const nextOnce = () => { if (!__done) { __done = true; automaNextBlock(); } };\n  (async function runVideoCollection() {\n    try {\n      automaResetTimeout();\n      const urls = await VideoCollectorUtils.collectVideos(250, {\n        scrollStepRatio: 0.92,\n        lazyPollMs: 3000,\n        lazyPollInterval: 300,\n        noProgressLimit: 8\n      });\n      const videos = transformUrlsToObjects(urls);\n      automaSetVariable('videos', videos);\n      console.log('‚úÖ videos set:', videos.length);\n      console.log('‚úÖ videos set raw array:', videos);\n      nextOnce();\n    } catch (err) {\n      console.error('‚ùå Error in runVideoCollection:', err);\n      automaSetVariable('videos', []);\n      nextOnce();\n    }\n  })();\n})();\n","context":"website","description":"","disableBlock":false,"everyNewTab":false,"preloadScripts":[],"runBeforeLoad":false,"timeout":20000},"label":"javascript-code"},{"id":"pupfkqb","type":"BlockBasic","initialized":false,"position":{"x":1287.0576948080147,"y":812.1644188622862},"data":{"description":"","disableBlock":false,"iconUrl":"","imageUrl":"","message":"Grabbed","title":"Grabbed"},"label":"notification"},{"id":"3gg1gay","type":"BlockBasicWithFallback","initialized":false,"position":{"x":1792.2292517665041,"y":458.72408690477994},"data":{"assignVariable":true,"body":"{\n  \"videos\":{{!variables@videos}}\n}\n","contentType":"json","dataColumn":"","dataPath":"","description":"","disableBlock":false,"headers":[],"method":"POST","responseType":"json","saveData":false,"timeout":10000,"url":"http://localhost:5000/dailyvids","variableName":"response"},"label":"webhook"},{"id":"xt51yzt","type":"BlockBasic","initialized":false,"position":{"x":2000.443132141377,"y":261.4254002230936},"data":{"description":"","disableBlock":false,"iconUrl":"","imageUrl":"","message":"{{!variables@response}}","title":"RESPONSE"},"label":"notification"},{"id":"r983hqh","type":"BlockBasic","initialized":false,"position":{"x":1905.381778217475,"y":762.8629485882087},"data":{"description":"","disableBlock":false,"iconUrl":"","imageUrl":"","message":"SERVER NOT FOUND","title":"ERROR SERVER"},"label":"notification"}],"edges":[{"id":"vueflow__edge-JnAVtOJ0zOultqutysm9NJnAVtOJ0zOultqutysm9N-output-1-2d7n5vo2d7n5vo-input-1","type":"custom","source":"JnAVtOJ0zOultqutysm9N","target":"2d7n5vo","sourceHandle":"JnAVtOJ0zOultqutysm9N-output-1","targetHandle":"2d7n5vo-input-1","updatable":true,"selectable":true,"data":{},"label":"","markerEnd":"arrowclosed","class":"connected-edges","sourceX":399.3486427692943,"sourceY":434.93834582953843,"targetX":535.7105255787203,"targetY":434.40396387314314},{"id":"vueflow__edge-2d7n5vo2d7n5vo-output-1-q3z056aq3z056a-input-1","type":"custom","source":"2d7n5vo","target":"q3z056a","sourceHandle":"2d7n5vo-output-1","targetHandle":"q3z056a-input-1","updatable":true,"selectable":true,"data":{},"label":"","markerEnd":"arrowclosed","sourceX":775.7105730004732,"sourceY":434.40396387314314,"targetX":942.7617437880156,"targetY":436.34225005071},{"id":"vueflow__edge-q3z056aq3z056a-output-1-pupfkqbpupfkqb-input-1","type":"custom","source":"q3z056a","target":"pupfkqb","sourceHandle":"q3z056a-output-1","targetHandle":"pupfkqb-input-1","updatable":true,"selectable":true,"data":{},"label":"","markerEnd":"arrowclosed","sourceX":1182.7618986582736,"sourceY":436.34225005071,"targetX":1263.0576743773263,"targetY":848.1644247900053},{"id":"vueflow__edge-q3z056aq3z056a-output-1-3gg1gay3gg1gay-input-1","type":"custom","source":"q3z056a","target":"3gg1gay","sourceHandle":"q3z056a-output-1","targetHandle":"3gg1gay-input-1","updatable":true,"selectable":true,"data":{},"label":"","markerEnd":"arrowclosed","sourceX":1182.7618986582736,"sourceY":436.34225005071,"targetX":1768.2293387843206,"targetY":506.72410304784336},{"id":"vueflow__edge-3gg1gay3gg1gay-output-1-xt51yztxt51yzt-input-1","type":"custom","source":"3gg1gay","target":"xt51yzt","sourceHandle":"3gg1gay-output-1","targetHandle":"xt51yzt-input-1","updatable":true,"selectable":true,"data":{},"label":"","markerEnd":"arrowclosed","class":"connected-edges","sourceX":2008.2293862060737,"sourceY":506.72410304784336,"targetX":1976.4432191591934,"targetY":297.42540615081276},{"id":"vueflow__edge-3gg1gay3gg1gay-output-fallback-r983hqhr983hqh-input-1","type":"custom","source":"3gg1gay","target":"r983hqh","sourceHandle":"3gg1gay-output-fallback","targetHandle":"r983hqh-input-1","updatable":true,"selectable":true,"data":{},"label":"","markerEnd":"arrowclosed","class":"connected-edges","sourceX":2008.2293862060737,"sourceY":528.7240770057641,"targetX":1881.3816503382814,"targetY":798.8629007916753}],"position":[-60.12886299967295,-24.36994651106906],"zoom":0.637604621180883,"viewport":{"x":-60.12886299967295,"y":-24.36994651106906,"zoom":0.637604621180883}},"settings":{"aipowerToken":"","blockDelay":0,"debugMode":false,"defaultColumnName":"column","execContext":"popup","executedBlockOnWeb":false,"inputAutocomplete":true,"insertDefaultColumn":false,"notification":true,"onError":"stop-workflow","publicId":"","restartTimes":3,"reuseLastState":false,"saveLog":true},"globalData":"{\n\t\"key\": \"value\"\n}","description":"This Automa workflow automates MidJourney video downloads: it opens the ‚ÄúTop Videos‚Äù tab, scrolls in batches, extracts and highlights .mp4 URLs, converts them into structured objects, then sends them via a webhook to a local server, showing success or error notifications.","includedWorkflows":{}}